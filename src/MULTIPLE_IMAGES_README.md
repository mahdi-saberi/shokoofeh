# راهنمای اضافه کردن چندین تصویر و ویدیو به محصولات

## خلاصه تغییرات

این سیستم امکان بارگذاری چندین تصویر و ویدیو برای هر محصول را فراهم می‌کند. هر محصول می‌تواند:
- یک تصویر اصلی داشته باشد
- چندین تصویر اضافی داشته باشد
- چندین ویدیو داشته باشد

## فایل‌های جدید ایجاد شده

### 1. مدل ProductMedia
- **مسیر**: `app/Models/ProductMedia.php`
- **توضیحات**: مدل برای مدیریت رسانه‌های محصول (تصاویر و ویدیوها)

### 2. Migration
- **مسیر**: `database/migrations/2025_01_28_000000_create_product_media_table.php`
- **توضیحات**: جدول جدید برای ذخیره رسانه‌های محصول

## تغییرات در فایل‌های موجود

### 1. مدل Product
- اضافه شدن روابط با `ProductMedia`
- متدهای جدید برای دسترسی به تصاویر و ویدیوها
- به‌روزرسانی `imageUrl` accessor

### 2. کنترلر ProductController
- اضافه شدن متد `handleProductMedia` برای مدیریت فایل‌ها
- به‌روزرسانی متدهای `store` و `update`
- اضافه شدن متدهای مدیریت رسانه

### 3. فرم‌های ایجاد و ویرایش محصول
- اضافه شدن فیلدهای بارگذاری چندین تصویر
- اضافه شدن فیلدهای بارگذاری ویدیو
- نمایش رسانه‌های موجود در فرم ویرایش

### 4. صفحه جزئیات محصول
- اضافه شدن اسلایدر برای نمایش تصاویر و ویدیوها
- امکان پخش ویدیوها
- ناوبری اسلایدر

## نحوه راه‌اندازی

### 1. اجرای Migration
```bash
php artisan migrate
```

### 2. اطمینان از وجود storage link
```bash
php artisan storage:link
```

### 3. تنظیم مجوزهای پوشه storage
```bash
chmod -R 775 storage
chmod -R 775 bootstrap/cache
```

## ساختار جدول product_media

| فیلد | نوع | توضیحات |
|------|-----|---------|
| id | INTEGER | شناسه یکتا |
| product_id | INTEGER | شناسه محصول (Foreign Key) |
| file_path | VARCHAR | مسیر فایل در storage |
| file_type | VARCHAR | نوع فایل (image/video) |
| mime_type | VARCHAR | نوع MIME فایل |
| original_name | VARCHAR | نام اصلی فایل |
| file_size | INTEGER | اندازه فایل (بایت) |
| is_main | BOOLEAN | آیا تصویر اصلی است |
| sort_order | INTEGER | ترتیب نمایش |
| created_at | TIMESTAMP | زمان ایجاد |
| updated_at | TIMESTAMP | زمان به‌روزرسانی |

## API Endpoints جدید

### حذف رسانه
```
DELETE /admin/media/{media}
```

### تنظیم تصویر اصلی
```
POST /admin/media/{media}/set-main
```

## نحوه استفاده

### 1. در فرم ایجاد محصول
- تصویر اصلی (اختیاری)
- تصاویر اضافی (چندین تصویر)
- ویدیوها (چندین ویدیو)

### 2. در فرم ویرایش محصول
- نمایش رسانه‌های موجود
- امکان حذف رسانه
- امکان تنظیم تصویر اصلی
- اضافه کردن رسانه‌های جدید

### 3. در صفحه جزئیات محصول
- اسلایدر خودکار
- ناوبری با دکمه‌ها
- نمایش نقاط برای هر رسانه
- پخش ویدیوها

## ویژگی‌های اضافی

### 1. پیش‌نمایش فایل‌ها
- پیش‌نمایش تصاویر قبل از آپلود
- نمایش اطلاعات فایل (نام و اندازه)
- پشتیبانی از drag & drop

### 2. مدیریت رسانه
- حذف رسانه‌های موجود
- تغییر تصویر اصلی
- مرتب‌سازی رسانه‌ها

### 3. اسلایدر خودکار
- تغییر خودکار اسلایدها هر 5 ثانیه
- ناوبری دستی
- نمایش نقاط برای هر اسلاید

## نکات مهم

### 1. امنیت
- بررسی نوع فایل
- محدودیت اندازه فایل
- بررسی مجوزهای کاربر

### 2. عملکرد
- استفاده از indexes برای جستجوی سریع
- lazy loading برای تصاویر
- بهینه‌سازی فایل‌ها

### 3. سازگاری
- پشتیبانی از مرورگرهای مختلف
- responsive design
- fallback برای مرورگرهای قدیمی

## عیب‌یابی

### مشکل: فایل‌ها آپلود نمی‌شوند
- بررسی مجوزهای پوشه storage
- بررسی تنظیمات PHP (upload_max_filesize, post_max_size)
- بررسی وجود storage link

### مشکل: تصاویر نمایش داده نمی‌شوند
- بررسی مسیر فایل‌ها
- بررسی مجوزهای فایل
- بررسی تنظیمات web server

### مشکل: ویدیوها پخش نمی‌شوند
- بررسی فرمت ویدیو
- بررسی تنظیمات MIME type
- بررسی پشتیبانی مرورگر

## پشتیبانی

برای سوالات و مشکلات:
1. بررسی لاگ‌های سیستم
2. بررسی تنظیمات سرور
3. بررسی مجوزهای فایل‌ها
4. بررسی اتصال دیتابیس 
