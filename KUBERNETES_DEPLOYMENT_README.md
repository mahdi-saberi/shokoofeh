# ุฑุงูููุง Deploy ฺฉุฑุฏู ุฏุฑ Kubernetes

## ูุดฺฉู ุงุตู
ุฏุฑ Docker Composeุ ูุฑ ุฏู ุณุฑูุณ `app` ู `nginx` ุงุฒ ฺฉ ูููุฏุฑ ูุดุชุฑฺฉ `./src` ุงุณุชูุงุฏู ูโฺฉููุฏ. ุงูุง ุฏุฑ Kubernetesุ ูุฑ Pod ุจุงุฏ volume ูุง ุฎูุฏุด ุฑุง ุฏุงุดุชู ุจุงุดุฏ.

## ุฑุงู ุญูโูุง ูพุดููุงุฏ

### ุฑุงู ุญู ฑ: ุงุณุชูุงุฏู ุงุฒ Init Container
ุงู ุฑุงู ุญู ุงุฒ ฺฉ init container ุงุณุชูุงุฏู ูโฺฉูุฏ ุชุง ูุงูโูุง source ุฑุง ฺฉูพ ฺฉูุฏ ู ุณูพุณ ูุฑ ุฏู container ุงุฒ ุขู ุงุณุชูุงุฏู ฺฉููุฏ.

**ูุฒุงุง:**
- ุณุงุฏู ู ูุงุจู ููู
- ูุงูโูุง ุฏุฑ ูุฑ restart ฺฉูพ ูโุดููุฏ

**ูุนุงุจ:**
- ุฏุฑ ูุฑ restart ุฒูุงู ุจุดุชุฑ ูโฺฏุฑุฏ
- ุงุฒ ูุถุง ุจุดุชุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ

### ุฑุงู ุญู ฒ: ุงุณุชูุงุฏู ุงุฒ Job + PersistentVolume
ุงุจุชุฏุง ฺฉ Job ุงุฌุฑุง ูโฺฉูู ุชุง ูุงูโูุง ุฑุง ฺฉูพ ฺฉูุฏุ ุณูพุณ ุงุฒ PersistentVolume ูุดุชุฑฺฉ ุงุณุชูุงุฏู ูโฺฉูู.

**ูุฒุงุง:**
- ูุงูโูุง ููุท ฺฉ ุจุงุฑ ฺฉูพ ูโุดููุฏ
- ูพุงุฏุงุฑ ู ูุงุจู ุงุนุชูุงุฏ

**ูุนุงุจ:**
- ูุงุฒ ุจู ุงุฌุฑุง ุฏุณุช Job ุฏุงุฑุฏ
- ูพฺุฏฺฏ ุจุดุชุฑ

### ุฑุงู ุญู ณ: ุงุณุชูุงุฏู ุงุฒ StatefulSet
ุงุฒ StatefulSet ุงุณุชูุงุฏู ูโฺฉูู ฺฉู volume ูุง ูพุงุฏุงุฑุชุฑ ุฏุงุฑุฏ.

**ูุฒุงุง:**
- ูพุงุฏุงุฑ ู ูุงุจู ุงุนุชูุงุฏ
- ูุฏุฑุช ุจูุชุฑ volume ูุง

**ูุนุงุจ:**
- ูพฺุฏฺฏ ุจุดุชุฑ
- ูุงุฒ ุจู ุชูุธูุงุช ุงุถุงู

## ูุฑฺูโุจูุฏ Image ูุง

### ๐ Laravel App
- **ูุฑฺู ุฌุฏุฏ**: ูุฑ ุจุงุฑ buildุ ูุฑฺู ุฌุฏุฏ ุจุง ูุฑูุช `YYYY.MM.DD-HHMM` ุงุฌุงุฏ ูโุดูุฏ
- **Latest**: ููุดู ุขุฎุฑู ูุฑฺู build ุดุฏู
- **ูุซุงู**: `2025.01.28-1430`, `2025.01.28-1500`

### ๐ Nginx
- **ูุฑฺู ุซุงุจุช**: `1.29.1-alpine` (ูุฑฺู ูพุงุฏุงุฑ)
- **ุชุบุฑุงุช**: ููุท ุฏุฑ ุตูุฑุช ูุงุฒ ุจู upgrade ุงููุช
- **ูฺฉุชู ููู**: ุงุฒ ูุฑฺู ุฏูู ุงุณุชูุงุฏู ูโุดูุฏ ูู `stable` ุง `latest`

### ๐๏ธ MySQL
- **ูุฑฺู ุซุงุจุช**: `8.0` (ูุฑฺู ูพุงุฏุงุฑ)
- **ุชุบุฑุงุช**: ููุท ุฏุฑ ุตูุฑุช ูุงุฒ ุจู upgrade ุงููุช

## ูุญูู ุงุณุชูุงุฏู

### ูุฑุญูู ฑ: ุงุฌุฑุง Job ุจุฑุง ฺฉูพ ฺฉุฑุฏู ูุงูโูุง
```bash
kubectl apply -f k8s-source-copy-job.yaml
```

### ูุฑุญูู ฒ: ุจุฑุฑุณ ุชฺฉูู Job
```bash
kubectl get jobs
kubectl logs job/copy-source-files
```

### ูุฑุญูู ณ: ุงุฌุฑุง Deployment
```bash
# ุจุฑุง ุฑุงู ุญู ฑ
kubectl apply -f k8s-deployment.yaml

# ุง ุจุฑุง ุฑุงู ุญู ณ
kubectl apply -f k8s-statefulset.yaml
```

### ูุฑุญูู ด: ุจุฑุฑุณ ูุถุนุช
```bash
kubectl get pods
kubectl get services
kubectl get pvc
```

## ูุฏุฑุช ูุฑฺูโูุง

### ๐ ุจูโุฑูุฒุฑุณุงู ูุฑฺูโูุง
```bash
# ุงุฌุฑุง ุงุณฺฉุฑูพุช ุจูโุฑูุฒุฑุณุงู
./update-versions.sh

# ุง ุฏุณุช
./version-manager.sh
```

### ๐ ูุงูโูุง ูุฑฺู
- `k8s-versions.yaml` - ุชุนุฑู ูุฑฺูโูุง ุฏูู
- `k8s-versions.env` - ูุงู ูุญุท (ุชูุณุท version-manager.sh ุงุฌุงุฏ ูโุดูุฏ)

### ๐ฏ ุงูุชุฎุงุจ ูุฑฺู ููุงุณุจ
- **Development**: ุงุฒ `latest` ุงุณุชูุงุฏู ฺฉูุฏ
- **Production**: ุงุฒ ูุฑฺู ุฏูู ุงุณุชูุงุฏู ฺฉูุฏ
- **Nginx & MySQL**: ููุดู ุงุฒ ูุฑฺู ุซุงุจุช ุงุณุชูุงุฏู ฺฉูุฏ

## ูฺฉุงุช ููู

1. **Storage Class**: ูุทูุฆู ุดูุฏ ฺฉู storage class ููุงุณุจ ุฏุฑ cluster ุดูุง ููุฌูุฏ ุงุณุช
2. **Access Modes**: ุจุฑุง volume ูุดุชุฑฺฉ ุงุฒ `ReadWriteMany` ุงุณุชูุงุฏู ฺฉูุฏ
3. **Resource Limits**: ุญุฌู storage ููุฑุฏ ูุงุฒ ุฑุง ุจุฑ ุงุณุงุณ ูพุฑูฺู ุชูุธู ฺฉูุฏ
4. **Backup**: ุจุฑุง ูุงูโูุง ููู backup strategy ุฏุงุดุชู ุจุงุดุฏ
5. **ูุฑฺูโุจูุฏ**: nginx ู mysql ููุดู ูุฑฺู ุซุงุจุช ุฏุงุดุชู ุจุงุดูุฏ

## ุชูุธูุงุช ุงุถุงู

### ุจุฑุง Production
- ุงุฒ `ReadWriteMany` storage class ุงุณุชูุงุฏู ฺฉูุฏ
- Resource limits ู requests ููุงุณุจ ุชูุธู ฺฉูุฏ
- Health checks ุงุถุงูู ฺฉูุฏ
- Monitoring ู logging ุงุถุงูู ฺฉูุฏ
- ุงุฒ ูุฑฺูโูุง ุฏูู ุงุณุชูุงุฏู ฺฉูุฏ

### ุจุฑุง Development
- ุงุฒ `emptyDir` ุจุฑุง ุชุณุช ุงุณุชูุงุฏู ฺฉูุฏ
- ุญุฌู storage ฺฉูุชุฑ ุชูุธู ฺฉูุฏ
- Debug mode ูุนุงู ฺฉูุฏ
- ุงุฒ `latest` ุจุฑุง app ุงุณุชูุงุฏู ฺฉูุฏ

## ุงุจุฒุงุฑูุง ฺฉูฺฉ

### ๐ **ุงุณฺฉุฑูพุชโูุง ููุฌูุฏ**
- `build-and-push.sh` - Build ู push image ูุง ุจุง ูุฑฺูโุจูุฏ
- `version-manager.sh` - ูุฏุฑุช ูุฑฺูโูุง
- `update-versions.sh` - ุจูโุฑูุฒุฑุณุงู ูุฑฺูโูุง ุฏุฑ Kubernetes
- `pull-images.sh` - Pull ฺฉุฑุฏู image ูุง

### ๐ **ูุงูโูุง Kubernetes**
- `k8s-deployment.yaml` - Development deployment
- `k8s-statefulset.yaml` - Production deployment
- `k8s-source-copy-job.yaml` - ฺฉูพ ฺฉุฑุฏู source files
- `k8s-versions.yaml` - ุชุนุฑู ูุฑฺูโูุง ุฏูู

## Workflow ูพุดููุงุฏ

### ฑ. **Development**
```bash
# ุชุบุฑุงุช ุฏุฑ ฺฉุฏ
git commit -m "feature: add new functionality"

# Build ู push
./build-and-push.sh

# Deploy ุฏุฑ development
kubectl apply -f k8s-deployment.yaml
```

### ฒ. **Production**
```bash
# ุงูุชุฎุงุจ ูุฑฺู ููุงุณุจ
./update-versions.sh

# ุจุฑุฑุณ ูุฑฺูโูุง
cat k8s-versions.yaml

# Deploy ุฏุฑ production
kubectl apply -f k8s-statefulset.yaml
```

## ๐ Troubleshooting

### ูุดฺฉูุงุช ุฑุงุฌ
1. **Volume mount errors**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู PVC ูุง ุฏุฑุณุช ุงุฌุงุฏ ุดุฏู ุจุงุดูุฏ
2. **Image pull errors**: ูุทูุฆู ุดูุฏ ฺฉู image ูุง ุฏุฑ registry ููุฌูุฏ ุจุงุดูุฏ
3. **Permission errors**: ุจุฑุฑุณ ฺฉูุฏ ฺฉู user ู group ุฏุฑุณุช ุชูุธู ุดุฏู ุจุงุดูุฏ
4. **Version conflicts**: ุงุฒ ูุฑฺูโูุง ุตุญุญ ุงุณุชูุงุฏู ฺฉูุฏ

### ุฏุณุชูุฑุงุช ููุฏ
```bash
# ุจุฑุฑุณ Pod ูุง
kubectl describe pod <pod-name>

# ุจุฑุฑุณ Events
kubectl get events --sort-by='.lastTimestamp'

# ุจุฑุฑุณ Logs
kubectl logs <pod-name> -c <container-name>

# ุจุฑุฑุณ ConfigMaps
kubectl get configmaps
kubectl describe configmap <configmap-name>
``` 