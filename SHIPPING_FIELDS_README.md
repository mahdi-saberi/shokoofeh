# ذخیره اطلاعات آدرس ارسال در پروفایل کاربر

## تغییرات انجام شده

### 1. اضافه کردن فیلدهای جدید به جدول users
- `phone`: شماره تماس کاربر
- `shipping_address`: آدرس کامل ارسال
- `postal_code`: کد پستی
- `city`: شهر
- `province`: استان

### 2. به‌روزرسانی مدل User
- فیلدهای جدید به `$fillable` اضافه شدند
- امکان ذخیره و بازیابی اطلاعات آدرس

### 3. به‌روزرسانی CheckoutController
- هنگام ثبت سفارش، اطلاعات آدرس در پروفایل کاربر ذخیره می‌شود
- برای کاربران جدید (guest) که حساب کاربری ایجاد می‌کنند، اطلاعات آدرس در پروفایلشان ذخیره می‌شود
- برای کاربران موجود، اطلاعات آدرس در پروفایلشان به‌روزرسانی می‌شود

### 4. به‌روزرسانی فرم checkout
- فیلدهای فرم با اطلاعات موجود در پروفایل کاربر پر می‌شوند
- کاربران دیگر نیازی به وارد کردن مجدد اطلاعات آدرس ندارند
- ترتیب فیلدها: کد پستی، استان، شهر (استان و شهر هر دو اجباری هستند)

## مزایا

1. **تجربه کاربری بهتر**: کاربران دیگر نیازی به وارد کردن مجدد اطلاعات آدرس ندارند
2. **صرفه‌جویی در زمان**: فرم checkout به صورت خودکار پر می‌شود
3. **دقت بیشتر**: احتمال خطا در وارد کردن اطلاعات کاهش می‌یابد
4. **ذخیره خودکار**: اطلاعات آدرس به صورت خودکار در پروفایل کاربر ذخیره می‌شود

## نحوه کارکرد

1. کاربر وارد صفحه checkout می‌شود
2. اگر قبلاً لاگین کرده باشد، فیلدها با اطلاعات موجود در پروفایلش پر می‌شوند
3. کاربر می‌تواند اطلاعات را ویرایش کند
4. هنگام ثبت سفارش، اطلاعات جدید در پروفایل کاربر ذخیره می‌شود
5. دفعه بعد که وارد صفحه checkout شود، فیلدها با اطلاعات جدید پر می‌شوند

## فایل‌های تغییر یافته

- `database/migrations/2025_01_27_000000_add_shipping_fields_to_users_table.php`
- `app/Models/User.php`
- `app/Http/Controllers/CheckoutController.php`
- `resources/views/checkout/index.blade.php`

## تغییرات اخیر

- **جابجایی فیلدها**: فیلد استان قبل از شهر قرار گرفته است
- **اجباری کردن فیلد استان**: فیلد استان نیز مانند شهر اجباری شده است
- **ترتیب منطقی**: کد پستی → استان → شهر

## نحوه اجرا

1. Migration اجرا شده است
2. Cache ها پاک شده‌اند
3. سیستم آماده استفاده است

## تست

برای تست عملکرد:
1. یک کاربر جدید ثبت‌نام کند
2. وارد صفحه checkout شود
3. اطلاعات آدرس را وارد کند
4. سفارش را ثبت کند
5. دوباره وارد صفحه checkout شود
6. فیلدها باید با اطلاعات قبلی پر شده باشند 